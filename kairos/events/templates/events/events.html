{% extends 'layout.html' %}

{% block title %}
    Home
{% endblock %}

{% block content %}
    {% comment %} <h1>Welcome to Home Page!</h1>
    <h2>Home Page Header 2</h2>
    <h3>Home Page Header 3</h3>
    <h4>Home Page Header 4</h4>
    <h5>Home Page Header 5</h5>
    <h6>Home Page Header 6</h6>
    <p>A paragraph on the home page.</p> {% endcomment %}

    {% comment %} <div class="grid-flow-col grid gap-2 mx-2">
        <button class="btn-primary">Primary button</button>
        <button class="btn-secondary">Alt button</button>
    </div> {% endcomment %}

    <div class="container mx-auto max-w-[1200px] px-8">

        <div class="flex flex-row my-16 space-x-4">
            <input class="w-2/3 rounded-lg" id="search" name="search" type="text" placeholder="Search Event"/>
            
            <div class="relative inline-block text-left">
                <!-- Dropdown Button -->
                <button id="dropdownButton" type="button" class="bg-purple-600 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-400">
                    Filter (alphabetical) â†‘
                </button>

                <!-- Dropdown Menu -->
                <div id="dropdownMenu" class="hidden absolute mt-2 w-56 rounded-md shadow-lg bg-purple-600 text-white z-10">
                    <div class="py-1">
                    <a href="#" class="block px-4 py-2 hover:bg-purple-500">Alphabetical</a>
                    <a href="#" class="block px-4 py-2 hover:bg-purple-500">Most Recent</a>
                    <a href="#" class="block px-4 py-2 hover:bg-purple-500">Most Popular</a>
                    </div>
                </div>
            </div>
            
        </div>

        <div x-data="eventsPage" x-init="init()" class="h-[50vh] max-h-[1000px] overflow-y-scroll space-y-8 pr-4">
        <template x-for="event in events" :key="event.id">
            <div class="w-full h-32 bg-white p-4 rounded-lg border-2 border-dark shadow">
                <h3 class="font-bold text-lg text-gray-800" x-text="event.title"></h3>
                <p class="text-gray-600" x-text="event.body"></p>
                <p class="text-xs text-gray-400 italic" x-text="event.slug"></p>
            </div>
        </template>
    
        <!-- Optional loading state -->
        <div x-show="events.length === 0" class="text-gray-500 text-center py-4">
            Loading events...
        </div>
    </div>
    
    </div>

{% endblock %}

<script>
    document.addEventListener("alpine:init", () => {
      Alpine.data("eventsPage", () => ({
        events: [],
        async init() {
          const token = localStorage.getItem("access");
  
          if (!token) {
            window.location.href = "/login/";
            return;
          }
  
          try {
            const res = await fetch("/api/events/", {
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
              }
            });
  
            if (res.status === 401) {
              window.location.href = "/login/";
              return;
            }
  
            const data = await res.json();
            this.events = data; 
          } catch (err) {
            console.error("Error loading events:", err);
          }
        }
      }))
    });
  </script>