{% extends 'layout.html' %}

{% block title %}
    Events
{% endblock %}


{% block content %}
    <div x-data="eventsComponent()" class="container mx-auto max-w-[1200px] px-8">

        <form action="{% url 'events:list' %}" method="GET" class="max-h-fit flex mt-16 space-x-4 md:flex-row flex-col gap-y-4 md:gap-0 w-full">
          {% csrf_token %}
          {{ form }}
          <input value="{{request.GET.search}}" @keydown.enter="loadEvents();" class=" rounded-lg w-full md:w-2/3" id="search" name="search" type="text" placeholder="Search Event"  />

          <!-- Dropdown Menu -->
          <select value="{{request.GET.sort}}" onchange="this.form.submit()" name="sort" id="sort" class="bg-secondary text-white z-10 p-3 rounded-md transition-colors duration-300 hover:border-secondary border-2 border-light cursor-pointer md:w-1/3 w-full">
              <option value="alphabetical-increasing" {% if request.GET.sort == "alphabetical-increasing"%}selected{% endif %}>Alphabetical Increasing</option>
              <option value="alphabetical-decreasing" {% if request.GET.sort == "alphabetical-decreasing"%}selected{% endif %}>Alphabetical Decreasing</option>

              <option value="most-recent" {% if request.GET.sort == "most-recent"%}selected{% endif %}>Most Recent</option>
              <option value="least-recent" {% if request.GET.sort == "least-recent"%}selected{% endif %}>Least Recent</option>
          </select>
        </form>
        
        <div class="space-y-8 pr-4 py-12">
          {% if events %}
            {% for event in events %}
            <div class="flex items-start gap-4 p-4 bg-white rounded-xl shadow-sm w-full max-w-full">
    
              <!-- Event icon / image placeholder -->
              <div class="w-16 h-16 bg-gray-200 rounded-xl flex items-center justify-center">
                  <span class="text-gray-500 text-xl">ðŸ“…</span>
              </div>
          
              <!-- Text content -->
              <div>
                  <h2 class="text-xl font-semibold">{{ event.title }}</h2>
                  <p class="text-gray-600">{{ event.body }}</p>
          
                  <p class="text-sm text-gray-400 mt-1">
                      {{ event.date }}
                  </p>
          
                  <a href="{% url 'events:event_detail' event.id %}" 
                     class="text-primary-200 font-semibold text-sm mt-2 inline-block hover:underline">
                      View Details â†’
                  </a>
              </div>
          </div>
          
            {% endfor %}
          {% else %}
            <div class="text-gray-500 text-center py-4">
              No events found. Create one in the admin panel.
            </div>
          {% endif %}
        </div>
    </div>

    {% comment %} <script>
      const eventsComponent = () => ({
        has_unread: false,
        open: false,
        notifications: [],

        async loadEvents() {
          console.log("Inside load events!");
          

          const res = await fetch('/events/', {method: 'GET', headers: {'X-CSRFToken': csrfToken} });
          if (res.ok) {
              const data = await res.json();
              console.log("Events recieved", data);
              this.event = data;
          } else {
              console.error('failed to load notifications');
          }
        }
      });
    </script> {% endcomment %}
    
    </div>

{% endblock %}


