{% extends 'layout.html' %}

{% block title %}
    Events
{% endblock %}


{% block content %}
    <div x-data="eventsComponent()" class="container mx-auto max-w-[1200px] px-8">

        <div class="max-h-fit flex my-16 space-x-4 md:flex-row flex-col gap-y-4 md:gap-0">
            <input @keydown.enter="loadEvents();" class=" rounded-lg w-full md:w-2/3" id="search" name="search" type="text" placeholder="Search Event"  />
            
            <div class="relative inline-block text-left">
                <!-- Dropdown Button -->
                <button id="dropdownButton" type="button" class="bg-secondary text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-400 ">
                    Filter (alphabetical) â†‘
                </button>

                <!-- Dropdown Menu -->
                <div id="dropdownMenu" class="hidden absolute mt-2 md:w-56 rounded-md shadow-lg bg-secondary text-white z-10">
                    <div class="py-1">
                    <a href="#" class="block px-4 py-2 hover:bg-primary-200">Alphabetical</a>
                    <a href="#" class="block px-4 py-2 hover:bg-primary-200">Most Recent</a>
                    <a href="#" class="block px-4 py-2 hover:bg-primary-200">Most Popular</a>
                    </div>
                </div>
            </div>
            
        </div>

        <div class="max-h-[50vh] overflow-y-scroll space-y-8 pr-4">
          {% if events %}
            {% for event in events %}
              <div class="w-full h-32 bg-white p-4 rounded-lg border-2 border-dark shadow">
                <h3 class="font-bold text-lg text-gray-800">{{ event.title }}</h3>
                <p class="text-gray-600">{{ event.body }}</p>
                <p class="text-xs text-gray-400 italic">{{ event.slug }}</p>
                <p class="text-sm text-gray-500 mt-1">{{ event.date }}</p>
              </div>
            {% endfor %}
          {% else %}
            <div class="text-gray-500 text-center py-4">
              No events found. Create one in the admin panel.
            </div>
          {% endif %}
        </div>
    </div>

    <script>
      const eventsComponent = () => ({
        async loadEvents() {
          console.log("Inside load events!");

          const res = await fetch('/events/', {method: 'GET', headers: {'X-CSRFToken': csrfToken} });
          //if (res.ok) {
           //   const data = await res.json();
           //   console.log("notifications recieved", data);
           //   this.notifications = data;
          //} else {
          //    console.error('failed to load notifications');
         // }
        }
      });
    </script>
    
    </div>

{% endblock %}


{% comment %} <script>
    document.addEventListener("alpine:init", () => {
      Alpine.data("eventsPage", () => ({
        events: [],
        async init() {
          const token = localStorage.getItem("access");
  
          if (!token) {
            window.location.href = "/login/";
            return;
          }
  
          try {
            const res = await fetch("/api/events/", {
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
              }
            });
  
            if (res.status === 401) {
              window.location.href = "/login/";
              return;
            }
  
            const data = await res.json();
            this.events = data; 
          } catch (err) {
            console.error("Error loading events:", err);
          }
        }
      }))
    });
  </script> {% endcomment %}