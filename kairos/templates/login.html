{% extends 'base_auth.html' %}

{% block title %}Login{% endblock %}

{% block content %}
<section class="min-h-screen flex items-center justify-center bg-gradient-to-b from-light to-white">
  <div class="w-full max-w-lg p-12 rounded-2xl shadow-2xl border border-gray-100">
    <h1 class="text-4xl font-extrabold text-dark text-center mb-3">
      Welcome back to Kairos
    </h1>
    <p class="text-gray-500 text-center mb-10">
      Log in to manage your schedule effortlessly
    </p>
  </br> 
    <div x-data="loginForm()" class="space-y-6">
      <form @submit.prevent="submitLogin" class="space-y-6">
        {% csrf_token %}

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
          <input
            x-model="username"
            type="text"
            name="username"
            placeholder="Enter your username"
            class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-primary-100 focus:outline-none focus:border-primary-200 text-gray-800"
            required
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
          <input
            x-model="password"
            type="password"
            name="password"
            placeholder="Enter your password"
            class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-primary-100 focus:outline-none focus:border-primary-200 text-gray-800"
            required
          />
        </div>
        <p x-text="error" class="text-center text-red-500 text-sm" x-show="error"></p>
      </br>
        <button
          type="submit"
          class="w-full bg-gradient-to-r from-primary-200 to-secondary text-white py-3 rounded-lg font-semibold text-lg hover:opacity-90 transition shadow-md"
        >
          Log In
        </button>

        <p class="text-center text-sm text-gray-600 mt-6">
          Donâ€™t have an account?
          <a href="/signup/" class="text-primary-100 font-medium hover:underline">Sign up</a>
        </p>
      </form>
    </div>
  </div>
</section>

<script>
  function loginForm() {
    return {
      username: '',
      password: '',
      error: '',
      async submitLogin() {
        try {
          const res = await fetch('/api/token/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              username: this.username,
              password: this.password
            }),
          });

          if (!res.ok) {
            this.error = 'Invalid username or password.';
            return;
          }

          const data = await res.json();
          localStorage.setItem('access', data.access);
          localStorage.setItem('refresh', data.refresh);
          window.location.href = '/events/';
        } catch (err) {
          this.error = 'Server error. Please try again later.';
        }
      }
    };
  }
</script>
{% endblock %}
